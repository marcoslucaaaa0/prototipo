"use strict";!function(){function e(e){return""!==e.trim()}function o(e,o){o?u(e):(y=e,n()),c()}function t(e){if(!e)return void b(document.querySelector(v).getAttribute("data-size-invalid"));var t=document.querySelector("[data-persona]"),r=document.querySelector("[data-builder-persona]"),n=k.getState().pdp.persona.selected;S=e,r?window.freedom.nsPubSub.pub("builder.personalization.get",o):t?window.freedom.nsPubSub.pub("personalization.get",o):n&&n.state?o(n.list,!0):o(void 0)}function r(){window.freedom.nsPubSub.pub("ColorFlavorSize.select.size",t)}function n(){if(y){var o=[];y.name&&""!==y.name&&e(y.name)&&o.push({sku:y.nameSku,value:y.name}),y.number&&""!==y.number&&o.push({sku:y.numberSku,value:y.number}),h=o}}function u(e){try{h=e}catch(o){console.error("call-to-action.buildPersonaList",o)}}function a(){try{var e=document.querySelector(v).getAttribute("data-seller");return e?+e:(e=document.querySelector("[product-data-seller]").getAttribute("product-data-seller"),e?+e:0)}catch(o){return console.error("call-to-action.getSeller",o),0}}function i(){return 0===a()?h:[]}function c(){window.WansTools&&window.WansTools&&window.WansTools.ecProduct("add");var e={items:[{sku:S,quantity:g,seller:a(),personalizations:i(),interactiveDiscount:P(S,a())}]};s(e)}function d(e,o,t){var r="";if(t){var n=new Date;n.setTime(n.getTime()+24*t*60*60*1e3),r="; expires="+n.toUTCString()}document.cookie=e+"="+(o||"")+r+"; path=/"}function l(e){if(e.data.errors&&e.data.errors.length>0){var o="data-error",t=null;e.data.errors[0].code===q&&(o="data-error-"+q),"personalization.not.allowed"===e.data.errors[0].code&&(t=window.freedom.i18n.getMessage("product_errors_cart_persona_not_allow"));var r=document.querySelectorAll(v);if(r)for(var n=r.length;n--;)b(t||r[n].getAttribute(o))}else if(window.freedom.nsPubSub.pub("quickView.hasQuickView"))window.freedom.nsPubSub.pub("quickView.close"),window.freedom.nsPubSub.pub("miniCart.fixed");else if(document.querySelector("body").classList.contains("test__ab-upsell")){if(null!==document.querySelector(".showcase .buy-box .buy-button-now")){var u=document.querySelector(".showcase .buy-box .buy-button-now").getAttribute("data-sku");""===u&&(u=document.querySelector('input[type="hidden"][data-product-sku]').getAttribute("data-product-sku")),d("productUpSell",u,1)}else d("productUpSell","",1);window.location.href="/upsell-cart"}else window.location.href="/cart"}function s(e){var o={buttonWithLoading:document.querySelector(v),method:"post",data:e,success:function(e){l(e)},error:function(){b(document.querySelector(v).getAttribute("data-error"))}};window.freedom.restClient.request("/cart/add",o)}function b(e){try{var o=document.querySelectorAll("#buy-error");if(o)for(var t=o.length;t--;)o[t].innerHTML=e,window.freedom.removeClass(o[t],"hidden")}catch(r){console.error("call-to-action.showBuyError",r)}}function w(e){try{if(e)r();else{var o=window.freedom.i18n.getMessage("personalization_fields_generic_error");b(o)}}catch(t){console.error("call-to-action.checkPersona",t),r()}}function f(){try{var e=document.querySelector("[data-persona]"),o=document.querySelector("[data-new-persona]"),t=document.querySelector("[data-builder-persona]");e&&o&&!t?window.freedom.nsPubSub.pub("ColorFlavorSize.handleBuyEvent.checkPersona",w):r()}catch(n){console.error("call-to-action.handleBuyEvent",n)}}function m(){window.freedom.live(".buy-button-now","click",f)}function p(e){try{var o=document.querySelector("#buy-button-wrapper.main-buy-button-now");o&&(e?window.freedom.addClass(o,"hide"):window.freedom.removeClass(o,"hide"))}catch(t){console.error("call-to-action.hideOrShowMainBuyButton",t)}}var y,S,v=".buy-button-now",h=[],g=1,q="item.stock.unavailable",k=window.freedom.NsStore,P=function(e,o){var t=window.freedom.nsStorage.get("cp_sku")||[];return o=o.toString(),!!t.find(function(t){return t.sku===e&&t.sellerId===o})};!function(){m(),window.freedom.nsPubSub.sub("callToAction.restart",m),window.freedom.nsPubSub.sub("callToAction.hide.main-button",p)}()}();
//# sourceMappingURL=../../../../../target/maps/_refactoring/_components/product/call-to-action/all/call-to-action.min.js.map
