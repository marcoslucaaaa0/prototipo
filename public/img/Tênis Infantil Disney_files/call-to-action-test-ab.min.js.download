"use strict";!function(){function e(e){return""!==e.trim()}function t(e,t){t?a(e):(A=e,n()),i()}function o(e){if(!e)return void s(document.querySelector(T).getAttribute("data-size-invalid"));var o=document.querySelector("[data-persona]"),r=document.querySelector("[data-builder-persona]"),n=N.getState().pdp.persona.selected;_=e,r?window.freedom.nsPubSub.pub("builder.personalization.get",t):o?window.freedom.nsPubSub.pub("personalization.get",t):n&&n.state?t(n.list,!0):t(void 0)}function r(){if(document.querySelectorAll("#buy-box .product-size-selector .radio-options li.active").length)window.freedom.nsPubSub.pub("ColorFlavorSize.select.size",o);else{var e=document.querySelector(".test-ab-cta-floating li.active a").getAttribute("data-sku");o(e)}}function n(){if(A){var t=[];A.name&&""!==A.name&&e(A.name)&&t.push({sku:A.nameSku,value:A.name}),A.number&&""!==A.number&&t.push({sku:A.numberSku,value:A.number}),B=t}}function a(e){try{B=e}catch(t){console.error("call-to-action.buildPersonaList",t)}}function l(){try{var e="";return null!==document.querySelector("PRODUCT_BUY_BUTTON")&&(e=document.querySelector("PRODUCT_BUY_BUTTON").getAttribute("data-seller"))?+e:(e=document.querySelector("[product-data-seller]").getAttribute("product-data-seller"),e?+e:0)}catch(t){return console.error("call-to-action.getSeller",t),0}}function c(){return 0===l()?B:[]}function i(){var e={items:[{sku:_,quantity:E,seller:l(),personalizations:c()}]};console.log("call-to-action-test-ab.js",e),d(e)}function u(e){if(e.data.errors&&e.data.errors.length>0){var t="data-error",o=null;e.data.errors[0].code===x&&(t="data-error-"+x),"personalization.not.allowed"===e.data.errors[0].code&&(o=window.freedom.i18n.getMessage("product_errors_cart_persona_not_allow"));var r=document.querySelectorAll(T);if(r)for(var n=r.length;n--;)s(o||r[n].getAttribute(t))}else window.freedom.nsPubSub.pub("quickView.hasQuickView")?(window.freedom.nsPubSub.pub("quickView.close"),window.freedom.nsPubSub.pub("miniCart.fixed")):window.location.href="/cart"}function d(e){var t={buttonWithLoading:document.querySelector(T),method:"post",data:e,success:function(e){u(e)},error:function(){s(document.querySelector(T).getAttribute("data-error"))}};window.freedom.restClient.request("/cart/add",t)}function s(e){try{var t=document.querySelectorAll("#buy-error");if(t)for(var o=t.length;o--;)t[o].innerHTML=e,window.freedom.removeClass(t[o],"hidden");document.querySelector(".test-ab-cta-floating .right #buy-button-cta").removeAttribute("disabled")}catch(r){console.error("call-to-action.showBuyError",r)}}function f(e){try{if(e)r();else{var t=window.freedom.i18n.getMessage("personalization_fields_generic_error");s(t)}}catch(o){console.error("call-to-action.checkPersona",o),r()}}function m(){try{var e=document.querySelector("[data-persona]"),t=document.querySelector("[data-new-persona]"),o=document.querySelector("[data-builder-persona]");e&&t&&!o?window.freedom.nsPubSub.pub("ColorFlavorSize.handleBuyEvent.checkPersona",f):r()}catch(n){console.error("call-to-action.handleBuyEvent",n)}}function b(){if(P&&L){var e=L.getBoundingClientRect().top;e<-556?P.className.indexOf("cta-open-floater")<0&&(window.freedom.addClass(L,"cta-open-floater"),g()):window.freedom.removeClass(L,"cta-open-floater")}}function w(){P&&window.addEventListener("scroll",b)}function y(){if(null!==document.querySelector(".test-ab-cta-floating .rating-stars>a")){var e=document.querySelectorAll(".rating-stars>a");e.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var t=document.querySelector(".reviews").offsetTop;window.scrollTo(0,t-160)})})}}function p(){window.freedom.live("button.tell_me_back","click",function(){var e=document.querySelectorAll('#buy-box [data-type=size] .product-item[qa-option="available"]');e.length?e[0].click():(e=document.querySelectorAll('#buy-box [data-type=color] .ns-color[qa-option="available"]'),e[0].click()),document.querySelector(".test-ab-cta-floating .form-tell-me").style.display="none"})}function v(){document.querySelector(".test-ab-cta-floating .product-info").style.display="none",document.querySelector(".test-ab-cta-floating .selector-color").style.display="block",window.freedom.addClass(L,"cta-product-size")}function S(){document.querySelector(".test-ab-cta-floating .product-info").style.display="block",document.querySelector(".test-ab-cta-floating .selector-color").style.display="none"}function g(){document.querySelectorAll(".buy-error").forEach(function(e){e.classList.add("hidden")})}function q(){window.freedom.live("#buy-box .sku-select [data-type=size] li","click",function(e){e.target.parentElement.className.indexOf("unavailable")>=0?(window.freedom.removeClass(L,"cta-product-size"),window.freedom.addClass(L,"cta-product-unavailable")):window.freedom.removeClass(L,"cta-product-unavailable")}),window.freedom.nsPubSub.sub("color-flavor-size.changeHtml.after",function(){window.setTimeout(function(){document.querySelectorAll("li.unavailable.active").length?document.querySelectorAll(".tell-me-button-wrapper").length?(window.freedom.addClass(L,"cta-product-unavailable"),window.freedom.removeClass(L,"cta-product-size")):(window.freedom.removeClass(L,"cta-product-unavailable"),S()):document.querySelectorAll(".tell-me-button-wrapper").length?(window.freedom.addClass(L,"cta-product-unavailable"),window.freedom.removeClass(L,"cta-product-size")):(document.querySelectorAll("[data-type=size] li.active").length&&(document.querySelector("body").classList.remove("cta-product-size"),S()),window.freedom.removeClass(L,"cta-product-unavailable"))},1e3)}),window.freedom.live("#buy-button-cta","click",function(e){e.preventDefault(),document.querySelector(".test-ab-cta-floating .right #buy-button-cta").setAttribute("disabled","disabled"),document.querySelectorAll("#buy-box .product-size-selector .radio-options li.active").length?m():v()})}function h(e){try{e.classList.contains("unavailable")?(window.freedom.removeClass(L,"cta-product-size"),window.freedom.addClass(L,"cta-product-unavailable"),document.querySelector(".test-ab-cta-floating .form-tell-me").style.display="block"):m()}catch(t){console.error("call-to-action.handleBuyEvent",t)}}function k(){window.freedom.live(".test-ab-cta-floating [data-type=size] li","click",function(e){e.preventDefault(),h(this)})}function C(){null!==P.getAttribute("data-cta-floater")&&(w(),q(),k(),p(),y(),document.querySelectorAll(".tell-me-button-wrapper").length&&(window.freedom.removeClass(L,"cta-product-size"),window.freedom.addClass(L,"cta-product-unavailable"),document.querySelector(".test-ab-cta-floating .form-tell-me").style.display="block"))}function z(){P=document.querySelector(".test-ab-cta-floating"),P&&C()}var A,_,P,T=".buy-button-now",B=[],E=1,x="item.stock.unavailable",L=document.getElementsByTagName("body")[0],N=window.freedom.NsStore;!function(){window.setTimeout(function(){z()},2500)}()}();
//# sourceMappingURL=../../../../../../target/maps/_refactoring/_components/product/call-to-action/all/test-ab/call-to-action-test-ab.min.js.map
